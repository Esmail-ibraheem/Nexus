<!--
Nexus: Expert‑Sliced GPU Scheduling — Architecture Overview (v1)
Responsive inline SVG diagram
-->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin: 0; background:#0b1020; color:#e8eefc}
    .wrap {padding: 16px 20px}
    .title {font-size: 20px; font-weight: 700; letter-spacing: .2px; margin-bottom: 8px}
    .subtitle {opacity:.8; font-size: 12px; margin-bottom: 12px}
    svg {width: 100%; height: auto; background: #0e1530; border-radius: 14px; box-shadow: 0 10px 30px rgba(0,0,0,.35)}
    .box {fill: #131c3f; stroke: #5b77ff; stroke-width: 1.2; rx: 10; ry: 10}
    .box2 {fill: #111a34; stroke: #36c6ff; stroke-width: 1.1; rx: 10; ry: 10}
    .box3 {fill: #131d2c; stroke: #21d19f; stroke-width: 1.1; rx: 10; ry: 10}
    .gpu {fill: #0f1a2e; stroke: #9aa7ff; stroke-dasharray: 6 4; rx: 14; ry: 14}
    .slice {fill:#16234b; stroke:#9aa7ff; stroke-width:1}
    .titleText {fill:#eaf0ff; font-weight:700; font-size:12px}
    .t {fill:#cfe2ff; font-size:11px}
    .small {fill:#cfe2ff; font-size:10px}
    .arrow {stroke:#9dd0ff; stroke-width:1.6; marker-end:url(#arrowhead)}
    .arrow2 {stroke:#21d19f; stroke-width:1.6; marker-end:url(#arrowhead2)}
    .legend {fill:#ffffff; opacity:.9; font-size:10px}
    .badge {fill:#1e2a59; stroke:#36c6ff; rx:7; ry:7}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">Nexus — Expert‑Sliced GPU Scheduling</div>
    <div class="subtitle">Architecture Overview • Triton kernels · CUDA Graphs · Dynamic GPU Slices · Stream Parallelism · Energy Telemetry</div>

    <svg viewBox="0 0 1200 820" role="img" aria-label="Architecture overview diagram for Expert‑Sliced GPU Scheduling">
      <defs>
        <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L8,3 L0,6 Z" fill="#9dd0ff" />
        </marker>
        <marker id="arrowhead2" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L8,3 L0,6 Z" fill="#21d19f" />
        </marker>
        <linearGradient id="gradBlue" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#1b2a6b"/>
          <stop offset="100%" stop-color="#121a3c"/>
        </linearGradient>
      </defs>

      <!-- Left: Data plane ingress -->
      <rect class="box" x="30" y="60" width="250" height="120"/>
      <text class="titleText" x="50" y="85">Token Ingress & Gating</text>
      <text class="t" x="50" y="110">• Inputs (tokens, shapes)</text>
      <text class="t" x="50" y="130">• Router logits</text>
      <text class="small" x="50" y="150">(k-of-N top‑k selection)</text>

      <!-- Triton routing kernel -->
      <rect class="box2" x="30" y="210" width="250" height="150"/>
      <text class="titleText" x="50" y="235">Triton Routing Kernel</text>
      <text class="t" x="50" y="260">softmax ⟶ top‑k ⟶ atomic expert counts</text>
      <text class="small" x="50" y="280">single‑pass, no intermed. tensors</text>
      <text class="small" x="50" y="300">3× lower memory traffic</text>

      <!-- Arrow to GPU complex -->
      <line class="arrow" x1="280" y1="285" x2="380" y2="285"/>

      <!-- GPU complex boundary -->
      <rect class="gpu" x="380" y="40" width="790" height="740"/>
      <text class="titleText" x="400" y="65">A100 / H100 GPU Complex</text>
      <text class="small" x="400" y="83">HBM, SMs, L2; MIG optional</text>

      <!-- Control plane top row inside GPU boundary -->
      <rect class="box2" x="410" y="110" width="250" height="110"/>
      <text class="titleText" x="430" y="135">Expert Profiler</text>
      <text class="t" x="430" y="160">runtime usage (ui tokens/s)</text>
      <text class="small" x="430" y="178">rolling window; hot/cold experts</text>

      <rect class="box2" x="680" y="110" width="250" height="110"/>
      <text class="titleText" x="700" y="135">GPU Slice Manager</text>
      <text class="t" x="700" y="160">dynamic/proportional allocation</text>
      <text class="small" x="700" y="178">evict/assign SM & BW slices</text>

      <rect class="box2" x="950" y="110" width="200" height="110"/>
      <text class="titleText" x="970" y="135">CUDA Graph Manager</text>
      <text class="small" x="970" y="160">warm‑up ⟶ capture ⟶ replay</text>
      <text class="small" x="970" y="178">minimize launch overhead</text>

      <!-- feedback arrows between control components -->
      <line class="arrow2" x1="660" y1="165" x2="680" y2="165"/>
      <line class="arrow2" x1="930" y1="165" x2="950" y2="165"/>

      <!-- Streams scheduler -->
      <rect class="box3" x="410" y="250" width="300" height="90"/>
      <text class="titleText" x="430" y="275">Stream Scheduler</text>
      <text class="t" x="430" y="298">assign experts ⟶ CUDA streams (N=8)</text>

      <!-- Arrows from control plane to streams -->
      <line class="arrow2" x1="535" y1="220" x2="535" y2="250"/>
      <line class="arrow2" x1="805" y1="220" x2="705" y2="250"/>
      <line class="arrow2" x1="1050" y1="220" x2="710" y2="250"/>

      <!-- GPU slices grid -->
      <rect class="box" x="410" y="360" width="740" height="340"/>
      <text class="titleText" x="430" y="385">GPU Execution Plane — Dynamic Slices</text>
      <text class="small" x="430" y="403">SM groups, BW, cache budget; MIG partitions when available</text>

      <!-- Draw 6 slices -->
      <g>
        <rect class="slice" x="430" y="420" width="220" height="120"/>
        <text class="t" x="440" y="445">Slice A — Hot Experts</text>
        <text class="small" x="440" y="465">larger SM share</text>
        <rect class="box2" x="445" y="475" width="190" height="50"/>
        <text class="small" x="455" y="505">Fused Expert MLP (Triton)</text>
      </g>
      <g>
        <rect class="slice" x="670" y="420" width="220" height="120"/>
        <text class="t" x="680" y="445">Slice B — Warm Experts</text>
        <text class="small" x="680" y="465">medium SM share</text>
        <rect class="box2" x="685" y="475" width="190" height="50"/>
        <text class="small" x="695" y="505">Batched Expert Kernel</text>
      </g>
      <g>
        <rect class="slice" x="910" y="420" width="220" height="120"/>
        <text class="t" x="920" y="445">Slice C — Cold Experts</text>
        <text class="small" x="920" y="465">share SMs</text>
        <rect class="box2" x="925" y="475" width="190" height="50"/>
        <text class="small" x="935" y="505">Time‑sliced / queued</text>
      </g>

      <g>
        <rect class="slice" x="430" y="560" width="220" height="120"/>
        <text class="t" x="440" y="585">Slice D — Aux</text>
        <text class="small" x="440" y="605">aggregation / residuals</text>
      </g>
      <g>
        <rect class="slice" x="670" y="560" width="220" height="120"/>
        <text class="t" x="680" y="585">Slice E — Router Backward</text>
        <text class="small" x="680" y="605">(training)</text>
      </g>
      <g>
        <rect class="slice" x="910" y="560" width="220" height="120"/>
        <text class="t" x="920" y="585">Slice F — MIG Instance</text>
        <text class="small" x="920" y="605">optional A100/H100</text>
      </g>

      <!-- Arrows from streams into slices -->
      <line class="arrow" x1="610" y1="340" x2="540" y2="420"/>
      <line class="arrow" x1="610" y1="340" x2="780" y2="420"/>
      <line class="arrow" x1="610" y1="340" x2="1010" y2="420"/>

      <!-- Output aggregation -->
      <rect class="box" x="410" y="720" width="300" height="40"/>
      <text class="t" x="420" y="745">Expert Outputs Aggregation (weighted sum / concat)</text>

      <!-- Arrow to egress -->
      <line class="arrow" x1="710" y1="740" x2="840" y2="740"/>
      <rect class="box" x="840" y="720" width="310" height="40"/>
      <text class="t" x="850" y="745">MoE Layer Output ⟶ next layer / loss</text>

      <!-- Energy Monitor sidecar -->
      <rect class="box3" x="30" y="400" width="250" height="120"/>
      <text class="titleText" x="50" y="425">Energy Monitor</text>
      <text class="small" x="50" y="445">NVML power · tokens/J</text>
      <text class="small" x="50" y="463">emits telemetry ⟶ profiler</text>
      <line class="arrow2" x1="280" y1="460" x2="410" y2="460"/>
      <line class="arrow2" x1="280" y1="440" x2="410" y2="180"/>

      <!-- Ingress to router arrow -->
      <line class="arrow" x1="155" y1="180" x2="155" y2="210"/>

      <!-- Legend -->
      <g>
        <rect x="30" y="560" width="250" height="140" fill="url(#gradBlue)" stroke="#3b4ea0" rx="12" ry="12"/>
        <text class="legend" x="45" y="585">Legend</text>
        <rect class="box" x="45" y="600" width="16" height="10"/>
        <text class="legend" x="70" y="609">Data plane / tensors</text>
        <rect class="box2" x="45" y="620" width="16" height="10"/>
        <text class="legend" x="70" y="629">Control kernels / managers</text>
        <rect class="box3" x="45" y="640" width="16" height="10"/>
        <text class="legend" x="70" y="649">Schedulers / telemetry</text>
        <line class="arrow" x1="48" y1="665" x2="62" y2="665"/>
        <text class="legend" x="70" y="669">data‑flow</text>
        <line class="arrow2" x1="48" y1="685" x2="62" y2="685"/>
        <text class="legend" x="70" y="689">control‑flow / feedback</text>
      </g>

      <!-- Badges -->
      <g>
        <rect class="badge" x="1010" y="60" width="150" height="22"/>
        <text class="small" x="1020" y="75">CUDA 12.1 · Triton 2.1</text>
        <rect class="badge" x="1010" y="86" width="150" height="22"/>
        <text class="small" x="1020" y="101">Streams: 8 (configurable)</text>
      </g>

    </svg>
  </div>
</body>
</html>
